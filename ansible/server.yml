---
- name: Install Requirements (Java, Docker) on servers
  hosts:
    - server1
    - server2
    - server3
  become: yes
  tasks:
    - include_role:
        name: common
        tasks_from: install_docker.yml
    - include_role:
        name: common
        tasks_from: install_java.yml

- name: Install Requirements (Java) on client
  hosts:
    - client
  become: yes
  tasks:
    - include_role:
        name: common
        tasks_from: install_java.yml

- name: Run postgres
  hosts:
    - server1
    - server2
    - server3
  become: yes
  tasks:
    - include_role:
        name: postgres


- name: Build server files
  hosts:
    - localhost
  tasks:
    - include_role:
        name: build
        tasks_from: build_server.yml

- name: Copy jar to servers
  hosts:
    - server1
    - server2
    - server3
  become: yes

  tasks:
#    - name: open the port
#      ufw:
#        rule: allow
#        port: "{{item}}"
#      loop:
##        - "{{hostvars[inventory_hostname]['port']}}"
##        - "{{hostvars[inventory_hostname]['postgres']}}"
    - include_role:
        name: build
        tasks_from: copy_jar.yml
      vars:
        jar: PaxosKV-server


- name: Copy jar to client
  hosts:
    - client
  become: yes
  tasks:
    - include_role:
        name: build
        tasks_from: copy_jar.yml
      vars:
        - jar: PaxosKV-performance
